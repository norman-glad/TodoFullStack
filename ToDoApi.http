# @baseUrl = http://localhost:5058
@baseUrl = https://todoapi-norm-d4ere5eda0hje8e6.canadacentral-01.azurewebsites.net

@contentType = application/json

@token = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ0ZXN0dXNlckBleGFtcGxlLmNvbSIsImp0aSI6IjYyNmJiYzk4LTg0YWYtNGU2Mi1iNDc2LTE1MWRhZDkzMDA2YiIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL25hbWVpZGVudGlmaWVyIjoiNGE0ZWFiMGItYTM4NC00YjIxLTk1OTQtNTUwZGUxM2ZiOWQ0IiwiZXhwIjoxNzY2MTI0NDEzLCJpc3MiOiJUb0RvQXBpIiwiYXVkIjoiVG9Eb0NsaWVudCJ9.dY4z5fal26vcTG7zTVMOvdaePpYmlzchTwVNNT3Kkfs","userId":"4a4eab0b-a384-4b21-9594-550de13fb9d4","email":"testuser@example.com
@taskId = YOUR_TASK_ID_HERE

###############################################################################
# CORS PREFLIGHT TESTS
###############################################################################

### Test 1: CORS Preflight - Check if CORS is enabled for all origins
OPTIONS {{baseUrl}}/api/auth/login
Origin: http://example.com
Access-Control-Request-Method: POST
Access-Control-Request-Headers: Content-Type, Authorization

### Test 2: CORS Preflight for Tasks endpoint (requires auth header)
OPTIONS {{baseUrl}}/api/tasks
Origin: http://localhost:3000
Access-Control-Request-Method: GET
Access-Control-Request-Headers: Content-Type, Authorization

### Test 3: CORS Preflight from a different origin
OPTIONS {{baseUrl}}/api/tasks
Origin: https://some-random-domain.com
Access-Control-Request-Method: POST
Access-Control-Request-Headers: Content-Type, Authorization

###############################################################################
# AUTHENTICATION ENDPOINTS
###############################################################################

### Test 4: Register a new user - Success case
POST {{baseUrl}}/api/auth/register
Content-Type: {{contentType}}

{
    "email": "testuser@example.com",
    "password": "Test123!",
    "userName": "testuser"
}

### Test 5: Register - Duplicate email (should fail after first registration)
POST {{baseUrl}}/api/auth/register
Content-Type: {{contentType}}

{
    "email": "testuser@example.com",
    "password": "Test123!",
    "userName": "testuser2"
}

### Test 6: Register - Invalid email format
POST {{baseUrl}}/api/auth/register
Content-Type: {{contentType}}

{
    "email": "invalid-email",
    "password": "Test123!",
    "userName": "testuser3"
}

### Test 7: Register - Password too short (less than 6 chars)
POST {{baseUrl}}/api/auth/register
Content-Type: {{contentType}}

{
    "email": "newuser@example.com",
    "password": "12345",
    "userName": "newuser"
}

### Test 8: Login - Success case (copy token from response)
POST {{baseUrl}}/api/auth/login
Content-Type: {{contentType}}

{
    "email": "testuser@example.com",
    "password": "Test123!"
}

### Test 9: Login - Wrong password
POST {{baseUrl}}/api/auth/login
Content-Type: {{contentType}}

{
    "email": "testuser@example.com",
    "password": "WrongPassword!"
}

### Test 10: Login - Non-existent user
POST {{baseUrl}}/api/auth/login
Content-Type: {{contentType}}

{
    "email": "nonexistent@example.com",
    "password": "Test123!"
}

###############################################################################
# TASKS ENDPOINTS (Require JWT Authorization)
# NOTE: Update @token variable with the token from login response
###############################################################################

### Test 11: Get all tasks - Without auth (should return 401)
GET {{baseUrl}}/api/tasks
Content-Type: {{contentType}}

### Test 12: Get all tasks - With auth (empty list initially)
GET {{baseUrl}}/api/tasks
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

### Test 13: Create a task - Success
POST {{baseUrl}}/api/tasks
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
    "title": "Buy groceries",
    "description": "Milk, eggs, bread, butter",
    "dueDate": "2025-12-25T10:00:00Z",
    "priority": 2
}

### Test 14: Create a task - Minimal data (only title)
POST {{baseUrl}}/api/tasks
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
    "title": "Quick task"
}

### Test 15: Create a task - With high priority
POST {{baseUrl}}/api/tasks
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
    "title": "Urgent: Submit report",
    "description": "Q4 financial report due",
    "dueDate": "2025-12-20T17:00:00Z",
    "priority": 1
}

### Test 16: Create a task - Without auth (should return 401)
POST {{baseUrl}}/api/tasks
Content-Type: {{contentType}}

{
    "title": "Unauthorized task"
}

### Test 17: Get tasks with pagination - Page 1, 5 items per page
GET {{baseUrl}}/api/tasks?page=1&pageSize=5
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

### Test 18: Get tasks - Filter by completed status
GET {{baseUrl}}/api/tasks?completed=false
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

### Test 19: Get tasks - Search by keyword
GET {{baseUrl}}/api/tasks?search=groceries
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

### Test 20: Get tasks - Combined filters (pagination + completed + search)
GET {{baseUrl}}/api/tasks?page=1&pageSize=10&completed=false&search=report
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

### Test 21: Get single task by ID
# NOTE: Update @taskId with a valid task ID from create response
GET {{baseUrl}}/api/tasks/{{taskId}}
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

### Test 22: Get task - Non-existent ID (should return 404)
GET {{baseUrl}}/api/tasks/00000000-0000-0000-0000-000000000000
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

### Test 23: Get task - Invalid GUID format (should return 400 or 404)
GET {{baseUrl}}/api/tasks/invalid-guid
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

### Test 24: Update task - Mark as completed
# NOTE: Update @taskId with a valid task ID
PUT {{baseUrl}}/api/tasks/{{taskId}}
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
    "isCompleted": true
}

### Test 25: Update task - Change title and priority
PUT {{baseUrl}}/api/tasks/{{taskId}}
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
    "title": "Updated: Buy groceries and snacks",
    "priority": 1
}

### Test 26: Update task - Full update
PUT {{baseUrl}}/api/tasks/{{taskId}}
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
    "title": "Completely updated task",
    "description": "New description here",
    "dueDate": "2025-12-31T23:59:59Z",
    "isCompleted": false,
    "priority": 3
}

### Test 27: Update task - Non-existent ID (should return 404)
PUT {{baseUrl}}/api/tasks/00000000-0000-0000-0000-000000000000
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
    "title": "This should fail"
}

### Test 28: Update task - Without auth (should return 401)
PUT {{baseUrl}}/api/tasks/{{taskId}}
Content-Type: {{contentType}}

{
    "title": "Unauthorized update"
}

### Test 29: Delete task - Success
# NOTE: Update with a task ID you want to delete
DELETE {{baseUrl}}/api/tasks/{{taskId}}
Authorization: Bearer {{token}}

### Test 30: Delete task - Non-existent ID (should return 404)
DELETE {{baseUrl}}/api/tasks/00000000-0000-0000-0000-000000000000
Authorization: Bearer {{token}}

### Test 31: Delete task - Without auth (should return 401)
DELETE {{baseUrl}}/api/tasks/{{taskId}}

###############################################################################
# SWAGGER ENDPOINT
###############################################################################

### Test 32: Access Swagger JSON
GET {{baseUrl}}/swagger/v1/swagger.json
Accept: application/json

###############################################################################
# HEALTH CHECK / SMOKE TEST
###############################################################################

### Test 33: Basic API connectivity test
GET {{baseUrl}}/api/tasks
Content-Type: {{contentType}}
Authorization: Bearer {{token}}
